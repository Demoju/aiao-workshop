# Business Rules - Unit 1 (Frontend)

## Overview

Frontend에서 적용되는 비즈니스 규칙 및 검증 로직을 정의합니다.

---

## 1. 장바구니 검증 규칙

### BR-CART-001: 빈 장바구니 검증
- **규칙**: 주문 생성 시 장바구니가 비어있으면 안 됨
- **검증 시점**: 주문 확정 버튼 클릭 시
- **에러 메시지**: "장바구니가 비어있습니다. 메뉴를 추가해주세요."
- **처리**: 주문 생성 중단

### BR-CART-002: 수량 최소값 검증
- **규칙**: 각 항목의 수량은 최소 1개 이상
- **검증 시점**: 수량 조절 시
- **에러 메시지**: N/A (수량 0이면 항목 삭제)
- **처리**: 수량 0 시 장바구니에서 항목 제거

### BR-CART-003: 수량 최대값 검증
- **규칙**: 각 메뉴의 최대 수량은 99개
- **검증 시점**: 메뉴 추가 또는 수량 증가 시
- **에러 메시지**: "메뉴당 최대 99개까지 주문 가능합니다."
- **처리**: 수량 증가 중단, Toast 알림 표시

### BR-CART-004: 중복 메뉴 처리
- **규칙**: 동일한 메뉴를 추가하면 수량만 증가
- **검증 시점**: 메뉴 추가 시
- **처리**: 
  - 기존 항목 존재 시: quantity++
  - 기존 항목 없음 시: 새 항목 추가

### BR-CART-005: 총 금액 계산
- **규칙**: totalAmount = Σ(menu.price × quantity)
- **검증 시점**: 장바구니 변경 시마다
- **처리**: 자동 재계산

---

## 2. 주문 검증 규칙

### BR-ORDER-001: 주문 생성 전 검증
- **규칙**: 주문 생성 전 다음 항목 검증
  - 장바구니가 비어있지 않음
  - 모든 항목의 quantity > 0
  - tableId, sessionId 존재
- **검증 시점**: 주문 확정 버튼 클릭 시
- **에러 메시지**: 
  - "장바구니가 비어있습니다"
  - "로그인 정보가 없습니다. 다시 로그인해주세요"
- **처리**: 검증 실패 시 주문 생성 중단

### BR-ORDER-002: 주문 취소 가능 조건
- **규칙**: Backend API 호출하여 취소 가능 여부 확인 (주문 수락 전만 취소 가능)
- **검증 시점**: 주문 취소 버튼 클릭 시
- **에러 메시지**: "이미 수락된 주문은 취소할 수 없습니다"
- **처리**: 취소 불가 시 버튼 비활성화 또는 에러 메시지 표시

### BR-ORDER-003: 주문 내역 필터링
- **규칙**: 현재 테이블 세션의 주문만 표시
- **검증 시점**: 주문 내역 조회 시
- **처리**: Backend에서 sessionId로 필터링된 데이터 수신

---

## 3. 인증 검증 규칙

### BR-AUTH-001: 테이블 로그인 필수 입력
- **규칙**: storeId, tableNumber, password 모두 필수
- **검증 시점**: 로그인 버튼 클릭 시
- **에러 메시지**: "모든 항목을 입력해주세요"
- **처리**: 빈 필드 있으면 로그인 중단

### BR-AUTH-002: 관리자 로그인 필수 입력
- **규칙**: storeId, username, password 모두 필수
- **검증 시점**: 로그인 버튼 클릭 시
- **에러 메시지**: "모든 항목을 입력해주세요"
- **처리**: 빈 필드 있으면 로그인 중단

### BR-AUTH-003: JWT 토큰 검증
- **규칙**: 모든 인증 필요 API 호출 시 JWT 토큰 필요
- **검증 시점**: API 호출 전 (Axios interceptor)
- **에러 메시지**: "로그인이 필요합니다"
- **처리**: 
  - 토큰 없음: 로그인 페이지로 이동
  - 토큰 만료: Refresh token으로 갱신 시도

### BR-AUTH-004: 세션 유지
- **규칙**: 페이지 새로고침 시 로그인 상태 유지
- **검증 시점**: 앱 초기화 시
- **처리**: SessionStorage에서 로그인 정보 복구

---

## 4. UI 입력 검증 규칙

### BR-INPUT-001: 수량 입력 검증
- **규칙**: 수량은 1~99 사이의 정수
- **검증 시점**: 수량 입력 시
- **에러 메시지**: "1~99 사이의 숫자를 입력해주세요"
- **처리**: 범위 벗어나면 입력 무시

### BR-INPUT-002: 테이블 번호 입력 검증
- **규칙**: 테이블 번호는 빈 문자열이 아님
- **검증 시점**: 로그인 시
- **에러 메시지**: "테이블 번호를 입력해주세요"
- **처리**: 빈 문자열이면 로그인 중단

### BR-INPUT-003: 비밀번호 입력 검증
- **규칙**: 비밀번호는 빈 문자열이 아님
- **검증 시점**: 로그인 시
- **에러 메시지**: "비밀번호를 입력해주세요"
- **처리**: 빈 문자열이면 로그인 중단

---

## 5. 데이터 지속성 규칙

### BR-PERSIST-001: 장바구니 LocalStorage 저장
- **규칙**: 장바구니 변경 시마다 LocalStorage에 저장
- **저장 시점**: 장바구니 상태 변경 시
- **저장 키**: "cart"
- **저장 형식**: JSON.stringify(CartState)

### BR-PERSIST-002: 로그인 정보 SessionStorage 저장
- **규칙**: 로그인 성공 시 SessionStorage에 저장
- **저장 시점**: 로그인 성공 시
- **저장 키**: 
  - Customer: "tableId", "sessionId", "storeId", "tableNumber"
  - Admin: "jwt_token", "adminId", "username"
- **저장 형식**: 문자열

### BR-PERSIST-003: 페이지 새로고침 시 복구
- **규칙**: 앱 초기화 시 LocalStorage/SessionStorage에서 상태 복구
- **복구 시점**: 앱 마운트 시
- **복구 대상**: 장바구니, 로그인 정보

---

## 6. 에러 처리 규칙

### BR-ERROR-001: 네트워크 에러 처리
- **규칙**: 네트워크 에러 발생 시 Modal 다이얼로그 표시
- **에러 메시지**: "네트워크 연결을 확인해주세요"
- **처리**: "재시도" 버튼 제공

### BR-ERROR-002: API 에러 처리
- **규칙**: Backend API 에러 발생 시 에러 메시지 표시
- **에러 메시지**: Backend에서 제공한 에러 메시지 또는 기본 메시지
- **처리**: Modal 또는 Toast로 표시

### BR-ERROR-003: React 에러 처리
- **규칙**: React 컴포넌트 에러 발생 시 ErrorBoundary에서 캐치
- **에러 메시지**: "오류가 발생했습니다"
- **처리**: 에러 페이지 표시 + "홈으로 이동" 버튼

### BR-ERROR-004: API 재시도 규칙
- **규칙**: API 호출 실패 시 최대 3회 자동 재시도
- **재시도 전략**: Exponential backoff (2^retries 초 대기)
- **처리**: 3회 실패 시 Toast 표시: "요청에 실패했습니다. 다시 시도해주세요."

---

## 7. SSE 연결 규칙

### BR-SSE-001: SSE 자동 재연결
- **규칙**: SSE 연결 끊김 시 자동 재연결
- **재연결 전략**: Exponential backoff (최대 30초)
- **처리**: 재연결 성공 시 초기 데이터 다시 로드

### BR-SSE-002: SSE 이벤트 처리
- **규칙**: SSE 이벤트 수신 시 즉시 UI 업데이트
- **이벤트 타입**:
  - "new-order": 신규 주문 추가
  - "order-status-change": 주문 상태 변경
  - "order-deleted": 주문 삭제
- **처리**: Zustand store 업데이트 → UI 자동 반영

### BR-SSE-003: SSE 초기 데이터 로드
- **규칙**: SSE 연결 전 REST API로 초기 주문 목록 로드
- **로드 시점**: AdminDashboardPage 마운트 시
- **처리**: GET /api/admin/orders 호출 → Zustand store 초기화

---

## 8. Admin 전용 규칙

### BR-ADMIN-001: 단일 Admin 가정
- **규칙**: Admin은 단 한 명만 존재
- **처리**: 동시성 충돌 고려 안 함

### BR-ADMIN-002: 테이블 세션 종료 확인
- **규칙**: 테이블 세션 종료 시 확인 다이얼로그 표시
- **확인 메시지**: "테이블 이용을 완료하시겠습니까?"
- **처리**: 사용자 확인 후 API 호출

### BR-ADMIN-003: 주문 삭제 확인
- **규칙**: 주문 삭제 시 확인 다이얼로그 표시
- **확인 메시지**: "주문을 삭제하시겠습니까?"
- **처리**: 사용자 확인 후 API 호출

---

## 9. UI/UX 규칙

### BR-UX-001: 주문 성공 피드백
- **규칙**: 주문 생성 성공 시 Toast 알림 표시 (2초)
- **메시지**: "주문이 완료되었습니다"
- **처리**: Toast 표시 후 즉시 메뉴 화면으로 이동

### BR-UX-002: 신규 주문 시각적 강조
- **규칙**: SSE로 받은 신규 주문은 시각적으로 강조
- **처리**: 
  - 맨 위에 추가
  - Fade-in 애니메이션
  - 배경색 하이라이트 (3초 후 사라짐)

### BR-UX-003: 로딩 인디케이터
- **규칙**: API 호출 중 LoadingSpinner 표시
- **표시 시점**: API 호출 시작 시
- **숨김 시점**: API 응답 수신 시

### BR-UX-004: 빈 주문 내역 메시지
- **규칙**: 주문 내역이 없을 때 안내 메시지 표시
- **메시지**: "주문 내역이 없습니다"
- **처리**: 빈 화면 대신 메시지 표시

### BR-UX-005: 이미지 로딩 실패 처리
- **규칙**: 메뉴 이미지 로딩 실패 시 Placeholder 이미지 표시
- **Placeholder**: 기본 음식 아이콘 또는 회색 박스
- **처리**: `<img>` 태그의 `onError` 이벤트 핸들러

---

## 10. 보안 규칙

### BR-SEC-001: XSS 방지
- **규칙**: 사용자 입력은 모두 sanitize
- **처리**: React의 기본 XSS 방지 기능 활용 (JSX 자동 이스케이프)

### BR-SEC-002: JWT 토큰 보안
- **규칙**: JWT 토큰은 SessionStorage에 저장 (XSS 취약하지만 요구사항)
- **처리**: SessionStorage에 저장, HTTPS 사용 권장

### BR-SEC-003: API 호출 인증
- **규칙**: 모든 인증 필요 API 호출 시 JWT 토큰 포함
- **처리**: Axios interceptor에서 자동으로 Authorization 헤더 추가

---

## Validation Summary

| 규칙 ID | 검증 항목 | 검증 시점 | 에러 처리 |
|---------|----------|----------|----------|
| BR-CART-001 | 빈 장바구니 | 주문 확정 시 | Toast 알림 |
| BR-CART-003 | 수량 최대값 (99) | 수량 증가 시 | Toast 알림 |
| BR-ORDER-001 | 주문 생성 전 검증 | 주문 확정 시 | Modal 에러 |
| BR-ORDER-002 | 주문 취소 가능 | 취소 버튼 클릭 시 | Backend API 확인 |
| BR-AUTH-001 | 로그인 필수 입력 | 로그인 시 | Toast 알림 |
| BR-AUTH-003 | JWT 토큰 검증 | API 호출 전 | 자동 갱신 또는 로그아웃 |
| BR-ERROR-004 | API 재시도 | API 실패 시 | 최대 3회 재시도 |
| BR-SSE-001 | SSE 재연결 | 연결 끊김 시 | 자동 재연결 |

---

## Notes

- 모든 검증 규칙은 사용자 경험을 고려하여 설계
- Frontend 검증은 UX 개선용, Backend 검증은 보안 및 데이터 무결성 보장
- 에러 메시지는 명확하고 사용자 친화적으로 작성
